"use client";import U from"react";import R from"linkify-react";import v from"react";import{jsx as w}from"react/jsx-runtime";function b({source:l,poster:i,aspectRatio:n}){let[e,g]=v.useState(!1),[s,a]=v.useState(!1),h=d=>new Promise((p,m)=>{let c=document.createElement("script");c.src=d,c.type="module",c.onload=()=>p(c),c.onerror=()=>m(new Error(`[react-farcaster-embed] Script load error for ${d}`)),document.head.appendChild(c)});return v.useEffect(()=>{let d="https://cdn.jsdelivr.net/npm/media-chrome@1/+esm",p="https://cdn.jsdelivr.net/npm/hls-video-element@1.0/+esm";return h(d).then(()=>{console.log("Media Chrome loaded successfully"),g(!0)}).catch(m=>{console.error("Media Chrome loading failed",m)}),h(p).then(()=>{console.log("HLS Video Element loaded successfully"),a(!0)}).catch(m=>{console.error("HLS Video Element loading failed",m)}),()=>{document.head.removeChild(document.head.querySelector(`script[src="${d}"]`)),document.head.removeChild(document.head.querySelector(`script[src="${p}"]`))}},[l,i,n]),w("div",{style:{aspectRatio:n},children:e&&s&&w("div",{className:"farcaster-embed-video-player",dangerouslySetInnerHTML:{__html:`<media-controller>
            <hls-video
              src="${l}"
              slot="media"
              volume="1"
              crossorigin
              playsinline
            ></hls-video>
            <media-poster-image
              slot="poster"
              src="${i}">
            </media-poster-image>
            <media-loading-indicator slot="centered-chrome" noautohide></media-loading-indicator>
            <media-control-bar>
              <media-play-button></media-play-button>
              <media-time-range></media-time-range>
              <media-time-display showduration remaining></media-time-display>
              <media-fullscreen-button></media-fullscreen-button>
            </media-control-bar>
          </media-controller>`}})})}import{jsx as r,jsxs as u}from"react/jsx-runtime";var k=()=>r("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:r("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})}),y=()=>u("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r("path",{d:"M17 2.1l4 4-4 4"}),r("path",{d:"M3 12.2v-2a4 4 0 0 1 4-4h12.8M7 21.9l-4-4 4-4"}),r("path",{d:"M21 11.8v2a4 4 0 0 1-4 4H4.2"})]}),L=()=>r("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:r("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})}),C=()=>u("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),r("circle",{cx:"12",cy:"12",r:"3"})]}),N=()=>u("svg",{width:"24",height:"24",viewBox:"0 0 1260 1260",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[u("g",{clipPath:"url(#fc-embed-clip1)",children:[r("path",{d:"M947.747 1259.61H311.861C139.901 1259.61 0 1119.72 0 947.752V311.871C0 139.907 139.901 0.00541362 311.861 0.00541362H947.747C1119.71 0.00541362 1259.61 139.907 1259.61 311.871V947.752C1259.61 1119.72 1119.71 1259.61 947.747 1259.61Z",fill:"#472A91"}),r("path",{d:"M826.513 398.633L764.404 631.889L702.093 398.633H558.697L495.789 633.607L433.087 398.633H269.764L421.528 914.36H562.431L629.807 674.876L697.181 914.36H838.388L989.819 398.633H826.513Z",fill:"white"})]}),r("defs",{children:r("clipPath",{id:"fc-embed-clip1",children:r("rect",{width:"1259.61",height:"1259.61",fill:"white"})})})]});import{jsx as t,jsxs as o}from"react/jsx-runtime";var W={className:"farcaster-embed-body-link",target:"_blank"},_=async(l,i)=>{try{let e=await(await fetch(`https://client.warpcast.com/v2/user-thread-casts?castHashPrefix=${i}&username=${l}&limit=5`)).json();return e.result.casts[0].castType==="root-embed"?e.result.casts[1]:e.result.casts[0]}catch{throw new Error("Unable to fetch cast.")}};function O({url:l,username:i,hash:n}){let[e,g]=U.useState(null);if(l){let s=l.split("/");i=s[3],n=s[4]}if(!i||!n)throw new Error("You must provide a Warpcast URL or username and hash to embed a cast.");return U.useEffect(()=>{(async()=>{let a=await _(i,n),h=a.author,d=`https://warpcast.com/~/profiles/${h.fid}`,p=new Date(a.timestamp),m={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0},c=p.toLocaleString("en-US",m),S=`https://warpcast.com/${h.username}/${a.hash}`,I=a.replies&&a.replies.count,x=a.reactions&&a.reactions.count,H=a.combinedRecastCount?a.combinedRecastCount:a.recasts.count,M=a.watches&&a.watches.count,f=a.embeds&&a.embeds.images,V=f&&f.length>0,E=a.embeds&&a.embeds.videos&&a.embeds.videos.length>0,$=a.embeds&&a.embeds.videos;g({cast:a,author:h,profileUrl:d,timestamp:c,warpcastUrl:S,replies:I,likes:x,recasts:H,watches:M,images:f,hasImages:V,hasVideos:E,videos:$})})()},[i,n]),e?o("div",{className:"not-prose farcaster-embed-container",children:[o("div",{className:"farcaster-embed-metadata",children:[t("a",{href:e.profileUrl,className:"farcaster-embed-avatar-link",children:t("img",{src:e.author.pfp.url,alt:`@${e.author.username}`,width:48,height:48,className:"farcaster-embed-author-avatar"})}),o("div",{className:"farcaster-embed-author",children:[t("p",{className:"farcaster-embed-author-display-name",children:e.author.displayName}),o("p",{className:"farcaster-embed-author-username",children:["@",e.author.username]})]}),t("div",{className:"farcaster-embed-timestamp",children:t("p",{children:e.timestamp})})]}),o("div",{className:"farcaster-embed-body",children:[t(R,{as:"p",options:W,children:e.cast.text}),e.hasImages&&t("div",{className:"farcaster-embed-image-container",children:e.images.map(s=>t("a",{href:s.url,target:"_blank",className:"farcaster-embed-image-link",children:t("img",{src:s.url,alt:s.alt,className:"farcaster-embed-image"})},s.url))}),e.hasVideos&&t("div",{className:"farcaster-embed-video-container",children:e.videos.map(s=>t(b,{source:s.sourceUrl,aspectRatio:s.width/s.height,poster:s.thumbnailUrl},s.url))})]}),e.cast.tags.length>0&&t("div",{children:o("div",{className:"farcaster-embed-channel",children:[e.cast.tags[0].imageUrl&&t("img",{src:e.cast.tags[0].imageUrl,alt:e.cast.tags[0].name,width:16,height:16,className:"farcaster-embed-channel-avatar"}),e.cast.tags[0].name&&t("p",{className:"farcaster-embed-channel-name",children:e.cast.tags[0].name})]})}),o("div",{className:"farcaster-embed-stats",children:[o("ul",{children:[t("li",{children:o("a",{className:"farcaster-embed-stats-link",href:e.warpcastUrl,target:"_blank",children:[t(k,{}),t("span",{children:e.replies.toLocaleString("en-US")})]})}),t("li",{children:o("a",{className:"farcaster-embed-stats-link",href:e.warpcastUrl,target:"_blank",children:[t(y,{}),t("span",{children:e.recasts.toLocaleString("en-US")})]})}),t("li",{children:o("a",{className:"farcaster-embed-stats-link",href:e.warpcastUrl,target:"_blank",children:[t(L,{}),t("span",{children:e.likes.toLocaleString("en-US")})]})}),t("li",{children:o("a",{className:"farcaster-embed-stats-link",href:e.warpcastUrl,target:"_blank",children:[t(C,{}),t("span",{children:e.watches.toLocaleString("en-US")})]})})]}),t("div",{className:"farcaster-embed-warpcast-icon",children:t("a",{href:e.warpcastUrl,title:"Show on Warpcast",target:"_blank",className:"farcaster-embed-warpcast-link",children:t(N,{})})})]})]}):null}export{O as FarcasterEmbed};
//# sourceMappingURL=index.mjs.map